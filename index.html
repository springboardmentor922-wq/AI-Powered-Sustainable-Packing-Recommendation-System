<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoPackAI | Sustainable Logistics</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- 1. CORE THEME --- */
        :root {
            --primary: #00b894; --secondary: #0984e3;
            --bg-gradient: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
            --glass: rgba(255, 255, 255, 0.9); --text-main: #2d3436;
        }
        [data-theme="dark"] {
            --primary: #55efc4; --secondary: #74b9ff;
            --bg-gradient: linear-gradient(120deg, #0f2027 0%, #203a43 100%);
            --glass: rgba(30, 39, 46, 0.95); --text-main: #dfe6e9;
        }

        body {
            font-family: 'Outfit', sans-serif; background: var(--bg-gradient);
            background-size: 200% 200%; animation: gradientMove 15s ease infinite;
            color: var(--text-main); min-height: 100vh;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* INTRO SPLASH */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1e272e; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            animation: fadeOut 1s ease 2.5s forwards;
        }
        .splash-text {
            font-size: 4rem; font-weight: 900;
            background: linear-gradient(to right, #00b894, #0984e3);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            opacity: 0; animation: scaleIn 1.5s ease 0.5s forwards;
        }
        @keyframes scaleIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

        /* MAIN CARD */
        .glass-island {
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 30px; padding: 50px; width: 100%; max-width: 1200px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); opacity: 0;
            animation: fadeIn 1s ease 3s forwards;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        /* INPUTS (Fixed Static Labels) */
        .input-group-custom { position: relative; margin-bottom: 30px; }
        .form-control, .form-select {
            background: transparent; border: none; border-bottom: 2px solid rgba(128,128,128,0.3);
            border-radius: 0; padding: 10px 0; color: var(--text-main); font-weight: 600; font-size: 1.1rem;
        }
        .form-control:focus, .form-select:focus { box-shadow: none; border-bottom-color: var(--primary); }
        .static-label {
            display: block; font-size: 0.8rem; font-weight: 700; 
            color: #999; text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 5px; transition: 0.3s;
        }
        .form-control:focus ~ .static-label, .form-select:focus ~ .static-label { color: var(--primary); }

        /* BUTTONS */
        .btn-analyze {
            background: linear-gradient(135deg, var(--primary), #00cec9); color: white;
            border: none; padding: 18px; border-radius: 50px; width: 100%; font-weight: 700;
            box-shadow: 0 10px 20px rgba(0, 184, 148, 0.3); transition: 0.3s;
        }
        .btn-analyze:hover { transform: translateY(-3px); }

        /* RESULTS */
        .result-card {
            background: rgba(128,128,128,0.05); border-radius: 20px; padding: 25px;
            margin-bottom: 20px; border-left: 6px solid transparent; opacity: 0; transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }
        .result-card.winner { border-left-color: var(--primary); background: linear-gradient(90deg, rgba(0,184,148,0.1), transparent); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* IMPACT BOX */
        .impact-box {
            background: linear-gradient(135deg, #00b09b, #96c93d); color: white;
            border-radius: 20px; padding: 30px; margin-top: 30px; position: relative; overflow: hidden;
            box-shadow: 0 15px 30px rgba(0, 176, 155, 0.3);
        }
        .impact-box i.bg-icon { opacity: 0.2; position: absolute; right: -20px; bottom: -20px; font-size: 8rem; transform: rotate(-15deg); }
        
        .theme-toggle { position: absolute; top: 30px; right: 30px; font-size: 1.5rem; cursor: pointer; color: var(--text-main); z-index: 100; }

        /* PRINT STYLES */
        @media print { .btn-analyze, .theme-toggle, form { display: none; } body { background: white; } .glass-island { box-shadow: none; border: none; } }
    </style>
</head>
<body>
    <div style="position: absolute; top: 40px; right: 60px; z-index: 1000;">
        <a href="/dashboard" style="
            background: rgba(255, 255, 255, 0.9); 
            color: #00b894; 
            padding: 12px 25px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: bold; 
            font-family: sans-serif;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #00b894;
            transition: 0.3s;
        " onmouseover="this.style.background='#00b894'; this.style.color='white'" 
           onmouseout="this.style.background='rgba(255, 255, 255, 0.9)'; this.style.color='#00b894'">
           ðŸ“Š View Dashboard
        </a>
    </div>
    <div id="splash-screen"><div class="splash-text">EcoPackAI</div></div>

    <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon" id="theme-icon"></i></div>

    <div class="glass-island">
        <div class="text-center mb-5">
            <h1 style="font-weight: 900; letter-spacing: -1px;">EcoPackAI</h1>
            <p class="text-muted text-uppercase small letter-spacing-2">AI-Powered Sustainable Packaging Recommendation System</p>
        </div>

        <div class="row">
            <div class="col-lg-5 pe-lg-5 border-end border-secondary border-opacity-10">
                <form id="predictionForm">
                    <div class="input-group-custom">
                        <label class="static-label">Item Name</label>
                        <input type="text" class="form-control" id="itemName" list="itemOptions" required autocomplete="off" placeholder="Type or select...">
                        <datalist id="itemOptions">
                            <option value="Laptop"><option value="Vaccine"><option value="Sofa">
                            <option value="Water"><option value="Apple"><option value="Oil">
                        </datalist>
                    </div>

                    <div class="input-group-custom">
                        <label class="static-label">Fragility</label>
                        <select class="form-select" id="fragility" required>
                            <option value="" disabled selected>Select level...</option>
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="input-group-custom">
                                <label class="static-label">Weight (kg)</label>
                                <input type="number" class="form-control" id="weight" value="1.0" step="0.1" required>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group-custom">
                                <label class="static-label">Distance (km)</label>
                                <input type="number" class="form-control" id="distance" value="500" required>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-analyze mt-3">Run Analysis <i class="fas fa-arrow-right ms-2"></i></button>
                </form>
            </div>

            <div class="col-lg-7 ps-lg-5">
                <div id="loader" class="text-center py-5" style="display: none;">
                    <div class="spinner-border text-success" role="status"></div>
                </div>

                <div id="resultsState" style="display: none;">
                    
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold m-0">Optimization Report</h5>
                        <div>
                            <span id="catBadge" class="badge bg-dark p-2 me-2">---</span>
                            <button onclick="window.print()" class="btn btn-sm btn-outline-secondary rounded-pill px-3"><i class="fas fa-download me-1"></i> PDF</button>
                        </div>
                    </div>

                    <div id="resultsContainer"></div>
                    <div class="mt-3 p-3 rounded bg-light border">
                        <div class="row text-center">
                            <div class="col">
                                <small class="text-muted">Suitability</small>
                                <h6 id="suitabilityScore">--</h6>
                            </div>
                            <div class="col">
                                <small class="text-muted">Sustainability</small>
                                <h6 id="sustainabilityScore">--</h6>
                            </div>
                            <div class="col">
                                <small class="text-muted">Cost Efficiency</small>
                                <h6 id="costScore">--</h6>
                            </div>
                            <div class="col">
                                <small class="text-muted">Confidence</small>
                                <h6 id="confidenceScore">--</h6>
                            </div>
                        </div>
                        <div class="text-center mt-2 small text-muted">
                            Baseline: <span id="baselineMaterial"></span>
                        </div>
                    </div>
                    
                    <div class="impact-box">
                        <i class="fas fa-leaf bg-icon"></i>
                        <h5 class="fw-bold mb-1">Environmental Impact</h5>
                        <p class="small opacity-75 mb-4">Savings vs. Standard Plastic Packaging:</p>
                        
                        <div class="row text-center position-relative" style="z-index: 2;">
                            <div class="col-6 border-end border-white border-opacity-25">
                                <h2 class="fw-bold m-0">â‚¹<span id="savedCost">0</span></h2>
                                <small>SAVED</small>
                            </div>
                            <div class="col-6">
                                <h2 class="fw-bold m-0"><span id="savedCO2">0</span> kg</h2>
                                <small>COâ‚‚ AVOIDED</small>
                            </div>
                        </div>

                        <div class="text-center mt-3 pt-3 border-top border-white border-opacity-25">
                            <span id="treeText" class="small opacity-90" style="font-size: 0.95rem;"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            html.setAttribute('data-theme', html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
            document.getElementById('theme-icon').className = html.getAttribute('data-theme') === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function getIcon(cat) {
            const map = {'Food & Perishables':'fa-apple-alt', 'Electronics':'fa-laptop', 'Medical & Pharma':'fa-first-aid', 'Furniture & Home':'fa-couch', 'Automotive & Industrial':'fa-cogs', 'Fashion & Luxury':'fa-tshirt', 'Chemicals & Hazmat':'fa-flask'};
            return map[cat] || 'fa-box';
        }

        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            document.getElementById('loader').style.display = 'block';
            document.getElementById('resultsState').style.display = 'none';

            const payload = {
                item_name: document.getElementById('itemName').value,
                fragility: document.getElementById('fragility').value,
                weight: document.getElementById('weight').value,
                distance: document.getElementById('distance').value
            };

            try {
                const res = await fetch('/predict', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
                const data = await res.json();

                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('resultsState').style.display = 'block';
                    document.getElementById('catBadge').innerHTML = `<i class="fas ${getIcon(data.category)} me-1"></i> ${data.category}`;

                    const container = document.getElementById('resultsContainer');
                    container.innerHTML = '';
                    
                    data.recommendations.forEach((item, index) => {
                        const isWin = index === 0;
                        const html = `
                            <div class="result-card ${isWin ? 'winner' : ''}" style="animation-delay: ${index*0.1}s">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="small text-muted fw-bold mb-1">${isWin ? '<i class="fas fa-trophy text-warning me-1"></i> BEST CHOICE' : `OPTION #${index+1}`}</div>
                                        <h6 class="fw-bold m-0">${item.material_name}</h6>
                                    </div>
                                    <div class="text-end">
                                        <div class="fw-bold">â‚¹${Number(item.cost).toFixed(2)}</div>
                                        <div class="small text-muted">${Number(item.co2).toFixed(2)} kg COâ‚‚</div>
                                    </div>
                                </div>
                            </div>`;
                        container.innerHTML += html;
                    });
                   
document.getElementById('suitabilityScore').innerText =
data.scores.suitability + " / 100";

document.getElementById('sustainabilityScore').innerText =
data.scores.sustainability + " / 100";

document.getElementById('costScore').innerText =
data.scores.cost_efficiency + " / 100";

document.getElementById('confidenceScore').innerText =
data.scores.confidence + "%";

document.getElementById('baselineMaterial').innerText =
data.baseline;

                    
                    const bestOption = data.recommendations[0];
                    const plasticCost = bestOption.cost * 1.25;
                    const plasticCO2  = bestOption.co2 * 1.30;

                    const savedRupees = (plasticCost - bestOption.cost).toFixed(2);
                    const avoidedCO2  = (plasticCO2 - bestOption.co2).toFixed(2);
                    const trees = Math.max(1, Math.round(avoidedCO2 / 3.5)); 

                    document.getElementById('savedCost').innerText = savedRupees;
                    document.getElementById('savedCO2').innerText = avoidedCO2;
                    document.getElementById('treeText').innerHTML = `â‰ˆ Equivalent to planting <b>${trees}</b> trees ðŸŒ³`;

                    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#00b894', '#0984e3', '#fdcb6e'] });

                }, 500);

            } catch (err) { alert("Server Error."); document.getElementById('loader').style.display = 'none'; }
        });
    </script>
</body>

</html>