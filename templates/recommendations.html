<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EcoPackAI – Recommendations</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>

  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-forest shadow-sm">
      <div class="container">
        <a class="navbar-brand fw-semibold" href="/">EcoPackAI</a>
        <div class="ms-auto">
          <a class="btn btn-sm btn-outline-light" href="/">New search</a>
        </div>
      </div>
    </nav>

    <main class="container py-4 py-lg-5">
      <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-3 mb-4">
        <div>
          <h1 class="h3 mb-1">Recommendations</h1>
          <div class="text-muted">
            {{ product.name }} • {{ product.category.title() }}
            {% if product.packaging_format %} • {{ product.packaging_format }}{% endif %}
          </div>
        </div>
        <div class="d-flex flex-wrap gap-2">
          <span class="badge rounded-pill bg-white text-dark border">Weight: {{ "%.2f"|format(product.weight_kg) }} kg</span>
          <span class="badge rounded-pill bg-white text-dark border">Budget: ₹{{ "%.2f"|format(product.budget_per_kg) }}/kg</span>
          <span class="badge rounded-pill bg-white text-dark border">Max CO₂: {{ "%.2f"|format(product.max_co2_kg) }} kgCO₂e</span>
          <span class="badge rounded-pill bg-white text-dark border">Shelf life: {{ product.shelf_life_days }} days</span>
        </div>
      </div>

      {% if recommendations|length == 0 %}
        <div class="alert alert-warning" role="alert">
          No packaging meets all constraints. Try increasing budget or CO₂ limit, or reducing weight requirements.
        </div>
      {% else %}
        <div class="row g-3 mb-4">
          {% set top = recommendations[0] %}
          <div class="col-12">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-4">
                <div class="d-flex flex-column flex-lg-row justify-content-between gap-3">
                  <div>
                    <div class="badge bg-forest-subtle text-forest fw-semibold mb-2">Top pick</div>
                    <h2 class="h4 mb-1">{{ top.material_name }}</h2>
                    <div class="text-muted">{{ top.primary_material }}</div>
                  </div>
                  <div class="d-flex flex-wrap gap-2">
                    <div class="metric-pill">
                      <div class="metric-label">AI score</div>
                      <div class="metric-value">{{ "%.1f"|format(top.ai_score) }}</div>
                    </div>
                    <div class="metric-pill">
                      <div class="metric-label">Predicted cost (₹/kg)</div>
                      <div class="metric-value">{{ "%.0f"|format(top.predicted_cost) }}</div>
                    </div>
                    <div class="metric-pill">
                      <div class="metric-label">Predicted CO₂</div>
                      <div class="metric-value">{{ "%.2f"|format(top.predicted_co2) }}</div>
                    </div>
                    <div class="metric-pill">
                      <div class="metric-label">Sustainability</div>
                      <div class="metric-value">{{ "%.0f"|format(top.sustainability_score) }}%</div>
                    </div>
                    <div class="metric-pill">
                      <div class="metric-label">Environmental score</div>
                      <div class="metric-value">
                        {% if top.environmental_score is not none %}
                          {{ "%.2f"|format(top.environmental_score) }}
                        {% else %}
                          —
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card border-0 shadow-sm">
          <div class="card-body p-0">
            <div class="p-4 pb-0">
              <h3 class="h5 mb-1">Ranking & comparison</h3>
              <p class="text-muted mb-0">
                Sorted by AI score (best first). Compare predicted cost, CO₂, sustainability and environmental score.
              </p>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="text-nowrap">Rank</th>
                    <th>Material</th>
                    <th class="text-nowrap">Primary</th>
                    <th class="text-nowrap text-end">AI score</th>
                    <th class="text-nowrap text-end">Cost (₹/kg)</th>
                    <th class="text-nowrap text-end">CO₂ (kgCO₂e)</th>
                    <th class="text-nowrap text-end">Sustainability (%)</th>
                    <th class="text-nowrap text-end">Env score</th>
                  </tr>
                </thead>
                <tbody>
                  {% for r in recommendations %}
                    <tr>
                      <td class="fw-semibold">{{ r.rank }}</td>
                      <td>
                        <div class="fw-semibold">{{ r.material_name }}</div>
                        {% if r.environmental_components %}
                          <div class="small text-muted">
                            Env components:
                            S={{ "%.2f"|format(r.environmental_components.sustainability_score) }},
                            CO₂={{ "%.2f"|format(r.environmental_components.co2_score) }}
                          </div>
                        {% endif %}
                      </td>
                      <td class="text-muted">{{ r.primary_material }}</td>
                      <td class="text-end">{{ "%.1f"|format(r.ai_score) }}</td>
                      <td class="text-end">{{ "%.0f"|format(r.predicted_cost) }}</td>
                      <td class="text-end">{{ "%.2f"|format(r.predicted_co2) }}</td>
                      <td class="text-end">{{ "%.0f"|format(r.sustainability_score) }}</td>
                      <td class="text-end">
                        {% if r.environmental_score is not none %}
                          {{ "%.2f"|format(r.environmental_score) }}
                        {% else %}
                          —
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      {% endif %}
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

